"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[41],{2041:(ae,p,n)=>{n.r(p),n.d(p,{ProfileModule:()=>te});var T=n(9132),h=n(6895),l=n(4006),N=n(148),m=n(5412),v=n(7392),P=n(3238),x=n(8739),U=n(4385),f=n(7009),A=n(6308),J=n(7155),I=n(266),S=n(1948),d=n(9549),y=n(4144),Y=n(6709),b=n(5655),D=n(7084),F=n(3848),Q=n(8425),R=n(6338),B=n(3546),V=n(455),M=n(7957),O=n(4517),u=n(4859),H=n(8951),g=n(3385),e=n(4650),C=n(646),w=n(2340),j=n(529);let Z=(()=>{class o{constructor(t){this._http=t}uploadImage(t){const i=new FormData;return i.append("avatar",t),new Promise((s,a)=>{this._http.post(w.N.server+"/upload/avatar",i).subscribe(r=>{s(r)})})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(j.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),k=(()=>{class o{constructor(t,i,s,a,r){this.data=t,this._dialogRef=i,this._snackBar=s,this._fuseLoadingService=a,this._profileService=r}ngOnInit(){this.initVarValues()}ngOnDestroy(){this.initVarValues()}ngAfterViewInit(){}onFileSelected(t){this.handleFile(t.target.files[0])}onDragOver(t){t.preventDefault()}onDrop(t){t.preventDefault(),this.handleFile(t.dataTransfer.files[0])}handleFile(t){this._dialogRef.close(t)}onCancel(){this._dialogRef.close(void 0)}initVarValues(){this.imagePreview=null}openSnackBar(t){this._snackBar.open(t,null,{duration:3e3,horizontalPosition:"right",verticalPosition:"top"})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.WI),e.Y36(m.so),e.Y36(f.ux),e.Y36(C.c),e.Y36(Z))},o.\u0275cmp=e.Xpm({type:o,selectors:[["image-dialog"]],decls:9,vars:0,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"w-full","space-y-1","focus:border-2","focus:border-red-500",3,"drop","dragover"],[1,"flex"],["type","file","name","avatar","id","avatar",1,"px-8","py-12","border-2","border-dashed","rounded-md","w-full",3,"change"],["align","end"],["mat-button","",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Drop & Drag / Select a file"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"fieldset",2),e.NdJ("drop",function(a){return i.onDrop(a)})("dragover",function(a){return i.onDragOver(a)}),e.TgZ(4,"div",3)(5,"input",4),e.NdJ("change",function(a){return i.onFileSelected(a)}),e.qZA()()()(),e.TgZ(6,"mat-dialog-actions",5)(7,"button",6),e.NdJ("click",function(){return i.onCancel()}),e._uU(8,"Cancel"),e.qZA()())},dependencies:[u.lW,m.uh,m.xY,m.H8],encapsulation:2}),o})();var z=n(8495),G=n(1683),L=n(3536);function X(o,c){if(1&o&&e._UZ(0,"img",29),2&o){const t=e.oxw();e.Q6J("src",t.imageFile.view,e.LSH)}}function K(o,c){1&o&&e._UZ(0,"mat-icon",30),2&o&&e.Q6J("svgIcon","heroicons_outline:user-circle")}function W(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye")}function E(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye-off")}function $(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye")}function q(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye-off")}function _(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye")}function ee(o,c){1&o&&e._UZ(0,"mat-icon",31),2&o&&e.Q6J("svgIcon","heroicons_solid:eye-off")}const oe=[{path:"",component:(()=>{class o{constructor(t,i,s,a,r,ne,ie){this._snackBar=t,this._fuseConfirmation=i,this._accountService=s,this._formBuilder=a,this._fuseLoadingService=r,this._profileService=ne,this._dialog=ie}ngOnInit(){this.initVarValues(),this.onReloadData()}ngOnDestroy(){this.initVarValues()}ngAfterViewInit(){}onSaveUserInfo(){this._fuseConfirmation.open({title:"Are you sure?",message:"You want to save your profile information?",icon:{show:!0,name:"heroicons_outline:information-circle",color:"info"},actions:{confirm:{label:"Yes",color:"primary"}},dismissible:!0}).afterClosed().subscribe(i=>{if("confirmed"===i&&this.userInfoForm.valid){const s={id:this.user.id,name:this.userInfoForm.value.name,avatar:this.userInfoForm.value.avatar||null,old_avatar:void 0};this.renameFile(),this.imageFile.file!==this.user.avatar&&(s.avatar=`/avatars/${this.imageFile.file.name}`),this._accountService.editUser(s).then(a=>{a.success&&(this.processUploadImage(this.imageFile.file),this.onReloadData(),this.openSnackBar("Profile saved Successfully"))})}})}onChangePassword(){this._fuseConfirmation.open({title:"Are you sure?",message:"You want to change your password?",icon:{show:!0,name:"heroicons_outline:exclamation",color:"warning"},actions:{confirm:{label:"Yes",color:"primary"}},dismissible:!0}).afterClosed().subscribe(i=>{if("confirmed"===i&&this.changePassForm.valid){if(!g.c.checkHash(this.changePassForm.value.oldPassword,this.user.password))return void this.openSnackBar("Old Password does not match");if(this.changePassForm.value.newPassword!==this.changePassForm.value.confirmPassword)return void this.openSnackBar("New Password does not match");this._accountService.editUser({id:this.user.id,password:g.c.makeHash(this.changePassForm.value.newPassword)}).then(s=>{s.success&&(this.onReloadData(),this.openSnackBar("Password change Successfully"))})}}),console.log(g.c.checkHash(this.changePassForm.value.oldPassword,this.user.password))}onFileSelected(){this._dialog.open(k,{width:"500px"}).afterClosed().subscribe(i=>{if(void 0!==i){const s=i,a=new FileReader;a.readAsDataURL(s),a.onload=()=>{this.imageFile.view=a.result},this.imageFile.file=s}})}onReloadData(){}initVarValues(){this.user=H.e.getUser(),this.createForms(this.user),this.imageFile={},this.imageFile.view=this.user.avatar?`${w.N.server}/public/${this.user.avatar}`:null}createForms(t=null){this.userInfoForm=this._formBuilder.group({name:new l.NI(t?t.name:null),role:new l.NI({value:t?t.role:null,disabled:!0})}),this.changePassForm=this._formBuilder.group({oldPassword:new l.NI(null,[l.kI.required]),newPassword:new l.NI(null,[l.kI.required]),confirmPassword:new l.NI(null,[l.kI.required])})}openSnackBar(t){this._snackBar.open(t,null,{duration:3e3,horizontalPosition:"right",verticalPosition:"top"})}processUploadImage(t){this._profileService.uploadImage(t).then(i=>{if(i.success)return i.success})}renameFile(){const t="avatar"+z.E.getCurrentTimestamp()+this.imageFile.file.name.substring(this.imageFile.file.name.lastIndexOf("."));this.imageFile.file=new File([this.imageFile.file],t,{type:this.imageFile.file.type})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.ux),e.Y36(G.R),e.Y36(L.i),e.Y36(l.qu),e.Y36(C.c),e.Y36(Z),e.Y36(m.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["profile"]],decls:62,vars:10,consts:[[1,"flex","flex-col","flex-auto","w-full"],[1,"flex-auto","p-4","sm:p-4"],[1,"h-full","min-h-300","max-h-fit","p-4"],[1,"text-3xl","font-bold"],[1,"mt-5"],[1,"my-7","bg-card","p-10","rounded","shadow","grid","grid-cols-1","md:grid-cols-12","gap-4"],[1,"col-span-2","place-items-start"],[1,"text-2xl","md:text-lg"],[1,"col-span-10"],[3,"formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"flex","col-span-2"],["matTooltip","Click to change avatar","matTooltipPosition","above",3,"click"],["class","object-cover w-32 h-32 rounded-full ring-4 ring-bg-card hover:ring-2 hover:ring-primary cursor-pointer","alt","User avatar",3,"src",4,"ngIf"],["class","object-cover w-32 h-32 rounded-full ring-4 ring-bg-card hover:ring-2 hover:ring-primary cursor-pointer",3,"svgIcon",4,"ngIf"],["matInput","","formControlName","name"],["matInput","","formControlName","role"],[1,"flex","justify-end"],["mat-raised-button","","color","primary",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"w-full"],["matInput","","type","password","formControlName","oldPassword"],["oldPasswordField",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],["matInput","","type","password","formControlName","newPassword"],["newPasswordField",""],["matInput","","type","password","formControlName","confirmPassword"],["confirmPasswordField",""],["alt","User avatar",1,"object-cover","w-32","h-32","rounded-full","ring-4","ring-bg-card","hover:ring-2","hover:ring-primary","cursor-pointer",3,"src"],[1,"object-cover","w-32","h-32","rounded-full","ring-4","ring-bg-card","hover:ring-2","hover:ring-primary","cursor-pointer",3,"svgIcon"],[1,"icon-size-5",3,"svgIcon"]],template:function(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),e._uU(4,"Profile"),e.qZA(),e.TgZ(5,"section",4)(6,"div",5)(7,"div",6)(8,"h3",7),e._uU(9,"Information"),e.qZA()(),e.TgZ(10,"div",8)(11,"form",9)(12,"div",10)(13,"div",11)(14,"button",12),e.NdJ("click",function(){return i.onFileSelected()}),e.YNc(15,X,1,1,"img",13),e.YNc(16,K,1,1,"mat-icon",14),e.qZA()(),e.TgZ(17,"mat-form-field")(18,"mat-label"),e._uU(19,"Name"),e.qZA(),e._UZ(20,"input",15),e.qZA(),e.TgZ(21,"mat-form-field")(22,"mat-label"),e._uU(23,"Role"),e.qZA(),e._UZ(24,"input",16),e.qZA()(),e.TgZ(25,"div",17)(26,"button",18),e.NdJ("click",function(){return i.onSaveUserInfo()}),e._uU(27,"Save"),e.qZA()()()()(),e.TgZ(28,"div",5)(29,"div",6)(30,"h3",7),e._uU(31,"Change Password"),e.qZA()(),e.TgZ(32,"div",8)(33,"form",9)(34,"div",19)(35,"mat-form-field",20)(36,"mat-label"),e._uU(37,"Old Password"),e.qZA(),e._UZ(38,"input",21,22),e.TgZ(40,"button",23),e.NdJ("click",function(){e.CHM(s);const r=e.MAs(39);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(41,W,1,1,"mat-icon",24),e.YNc(42,E,1,1,"mat-icon",24),e.qZA()(),e.TgZ(43,"mat-form-field",20)(44,"mat-label"),e._uU(45,"New Password"),e.qZA(),e._UZ(46,"input",25,26),e.TgZ(48,"button",23),e.NdJ("click",function(){e.CHM(s);const r=e.MAs(47);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(49,$,1,1,"mat-icon",24),e.YNc(50,q,1,1,"mat-icon",24),e.qZA()(),e.TgZ(51,"mat-form-field",20)(52,"mat-label"),e._uU(53,"Confirm Password"),e.qZA(),e._UZ(54,"input",27,28),e.TgZ(56,"button",23),e.NdJ("click",function(){e.CHM(s);const r=e.MAs(55);return e.KtG(r.type="password"===r.type?"text":"password")}),e.YNc(57,_,1,1,"mat-icon",24),e.YNc(58,ee,1,1,"mat-icon",24),e.qZA()()(),e.TgZ(59,"div",17)(60,"button",18),e.NdJ("click",function(){return i.onChangePassword()}),e._uU(61,"Change"),e.qZA()()()()()()()()()}if(2&t){const s=e.MAs(39),a=e.MAs(47),r=e.MAs(55);e.xp6(11),e.Q6J("formGroup",i.userInfoForm),e.xp6(4),e.Q6J("ngIf",i.imageFile.view),e.xp6(1),e.Q6J("ngIf",!i.imageFile.view),e.xp6(17),e.Q6J("formGroup",i.changePassForm),e.xp6(8),e.Q6J("ngIf","password"===s.type),e.xp6(1),e.Q6J("ngIf","text"===s.type),e.xp6(7),e.Q6J("ngIf","password"===a.type),e.xp6(1),e.Q6J("ngIf","text"===a.type),e.xp6(7),e.Q6J("ngIf","password"===r.type),e.xp6(1),e.Q6J("ngIf","text"===r.type)}},dependencies:[h.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,u.lW,v.Hw,d.KE,d.hX,d.R9,I.gM,y.Nt],encapsulation:2}),o})()}];let te=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.ez,l.u5,l.UX,u.ot,N.FA,m.Is,v.Ps,P.XK,x.TU,U.LD,f.ZX,A.JX,J.p0,I.AV,d.lN,y.c,P.si,Y.p9,b.Tx,D.To,Q.T5,F.Nh,R.ie,B.QW,V.rP,S.Fk,M.Bb,O.u,F.Nh,T.Bz.forChild(oe)]}),o})()}}]);